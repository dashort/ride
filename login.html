<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Secure Login - Motorcycle Escort Management</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #loginContainer {
      max-width: 450px;
      width: 100%;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 2.5rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
    }
    
    .header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .header h1 {
      color: #333;
      margin: 0 0 0.5rem 0;
      font-size: 1.8rem;
    }
    
    .header p {
      color: #666;
      margin: 0;
      font-size: 0.9rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: bold;
      color: #333;
    }
    
    input[type="email"], input[type="password"] {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    
    input[type="email"]:focus, input[type="password"]:focus {
      outline: none;
      border-color: #4285f4;
      box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
    }
    
    .password-strength {
      margin-top: 0.5rem;
      font-size: 0.8rem;
      display: none;
    }
    
    .strength-bar {
      height: 4px;
      width: 100%;
      background: #e0e0e0;
      border-radius: 2px;
      margin-top: 0.3rem;
      overflow: hidden;
    }
    
    .strength-fill {
      height: 100%;
      transition: all 0.3s ease;
      width: 0%;
    }
    
    .btn {
      width: 100%;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
      position: relative;
    }
    
    .btn-primary {
      background: #4285f4;
      color: white;
    }
    
    .btn-primary:hover:not(:disabled) {
      background: #3367d6;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
    }
    
    .btn-google {
      background: #ffffff;
      color: #333;
      border: 2px solid #e0e0e0;
    }
    
    .btn-google:hover:not(:disabled) {
      background: #f8f9fa;
      border-color: #c0c0c0;
      transform: translateY(-1px);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .divider {
      text-align: center;
      margin: 1.5rem 0;
      position: relative;
    }
    
    .divider::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 1px;
      background: #e0e0e0;
    }
    
    .divider span {
      background: white;
      padding: 0 1rem;
      color: #666;
      font-size: 0.9rem;
    }
    
    .message {
      margin-top: 1rem;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 0.9rem;
      display: none;
    }
    
    .message.error {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #ffcdd2;
    }
    
    .message.warning {
      background: #fff8e1;
      color: #f57f17;
      border: 1px solid #ffecb3;
    }
    
    .message.info {
      background: #e3f2fd;
      color: #1565c0;
      border: 1px solid #bbdefb;
    }
    
    .security-info {
      margin-top: 2rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 8px;
      font-size: 0.85rem;
      color: #666;
    }
    
    .security-features {
      display: flex;
      justify-content: space-around;
      margin-top: 1rem;
    }
    
    .security-feature {
      text-align: center;
      flex: 1;
    }
    
    .security-feature .icon {
      font-size: 1.5rem;
      margin-bottom: 0.3rem;
    }
    
    .loading {
      display: none;
      text-align: center;
      margin-top: 1rem;
    }
    
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #4285f4;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 1rem;
      }
      
      #loginContainer {
        padding: 2rem;
      }
    }
  </style>
</head>
<body>
<div id="loginContainer">
  <div class="header">
    <h1>üèçÔ∏è Secure Login</h1>
    <p>Motorcycle Escort Management System</p>
  </div>
  
  <form id="loginForm">
    <div class="form-group">
      <label for="email">Email Address</label>
      <input type="email" id="email" placeholder="Enter your email" required autocomplete="email">
    </div>
    
    <div class="form-group">
      <label for="password">Password</label>
      <input type="password" id="password" placeholder="Enter your password" required autocomplete="current-password">
      <div id="passwordStrength" class="password-strength">
        <div class="strength-bar">
          <div id="strengthFill" class="strength-fill"></div>
        </div>
        <span id="strengthText"></span>
      </div>
    </div>
    
    <button type="submit" id="loginBtn" class="btn btn-primary">
      üîë Sign In with Credentials
    </button>
  </form>
  
  <div class="divider">
    <span>or</span>
  </div>
  
  <button id="googleBtn" class="btn btn-google">
    üîê Sign In with Google
  </button>
  
  <div id="message" class="message"></div>
  
  <div id="loading" class="loading">
    <div class="spinner"></div>
    <p>Authenticating...</p>
  </div>
  
  <div class="security-info">
    <div style="text-align: center; margin-bottom: 1rem;">
      <strong>üîí Your Security is Our Priority</strong>
    </div>
    <div class="security-features">
      <div class="security-feature">
        <div class="icon">üõ°Ô∏è</div>
        <div>Encrypted</div>
      </div>
      <div class="security-feature">
        <div class="icon">üîê</div>
        <div>Secure Auth</div>
      </div>
      <div class="security-feature">
        <div class="icon">üì±</div>
        <div>2FA Ready</div>
      </div>
    </div>
  </div>
</div>

<script>
  // Security and UX enhancements
  let loginAttempts = 0;
  const maxAttempts = 5;
  
  // DOM elements
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const loginForm = document.getElementById('loginForm');
  const loginBtn = document.getElementById('loginBtn');
  const googleBtn = document.getElementById('googleBtn');
  const messageDiv = document.getElementById('message');
  const loadingDiv = document.getElementById('loading');
  const strengthDiv = document.getElementById('passwordStrength');
  const strengthFill = document.getElementById('strengthFill');
  const strengthText = document.getElementById('strengthText');
  
  // Initialize
  document.addEventListener('DOMContentLoaded', function() {
    setupEventListeners();
    focusEmailInput();
  });
  
  function setupEventListeners() {
    // Form submission
    loginForm.addEventListener('submit', handleCredentialLogin);
    
    // Google login
    googleBtn.addEventListener('click', handleGoogleLogin);
    
    // Input validation and UX
    emailInput.addEventListener('input', validateEmail);
    passwordInput.addEventListener('input', handlePasswordInput);
    
    // Prevent multiple submissions
    loginBtn.addEventListener('click', function(e) {
      if (loginBtn.disabled) {
        e.preventDefault();
      }
    });
    
    // Enter key handling
    passwordInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && !loginBtn.disabled) {
        handleCredentialLogin(e);
      }
    });
  }
  
  function focusEmailInput() {
    setTimeout(() => emailInput.focus(), 100);
  }
  
  function validateEmail() {
    const email = emailInput.value.trim();
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    if (email && !emailRegex.test(email)) {
      emailInput.style.borderColor = '#dc3545';
      showMessage('Please enter a valid email address', 'error');
    } else {
      emailInput.style.borderColor = '#e0e0e0';
      if (messageDiv.classList.contains('error') && messageDiv.textContent.includes('email')) {
        hideMessage();
      }
    }
  }
  
  function handlePasswordInput() {
    const password = passwordInput.value;
    
    if (password.length > 0) {
      strengthDiv.style.display = 'block';
      updatePasswordStrength(password);
    } else {
      strengthDiv.style.display = 'none';
    }
  }
  
  function updatePasswordStrength(password) {
    const strength = calculatePasswordStrength(password);
    
    let color, width, text;
    switch (strength.level) {
      case 'very-weak':
        color = '#dc3545'; width = '20%'; text = 'Very Weak';
        break;
      case 'weak':
        color = '#fd7e14'; width = '40%'; text = 'Weak';
        break;
      case 'medium':
        color = '#ffc107'; width = '60%'; text = 'Medium';
        break;
      case 'strong':
        color = '#28a745'; width = '80%'; text = 'Strong';
        break;
      case 'very-strong':
        color = '#20c997'; width = '100%'; text = 'Very Strong';
        break;
    }
    
    strengthFill.style.backgroundColor = color;
    strengthFill.style.width = width;
    strengthText.textContent = text;
    strengthText.style.color = color;
  }
  
  function calculatePasswordStrength(password) {
    let score = 0;
    
    if (password.length >= 8) score += 1;
    if (password.length >= 12) score += 1;
    if (/[a-z]/.test(password)) score += 1;
    if (/[A-Z]/.test(password)) score += 1;
    if (/\d/.test(password)) score += 1;
    if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) score += 1;
    
    if (score <= 1) return { level: 'very-weak' };
    if (score <= 2) return { level: 'weak' };
    if (score <= 3) return { level: 'medium' };
    if (score <= 4) return { level: 'strong' };
    return { level: 'very-strong' };
  }
  
  function handleCredentialLogin(e) {
    e.preventDefault();
    
    if (loginAttempts >= maxAttempts) {
      showMessage('Too many login attempts. Please refresh the page and try again.', 'error');
      return;
    }
    
    const email = emailInput.value.trim();
    const password = passwordInput.value;
    
    if (!email || !password) {
      showMessage('Please enter both email and password', 'error');
      return;
    }
    
    if (!isValidEmail(email)) {
      showMessage('Please enter a valid email address', 'error');
      return;
    }
    
    setLoading(true);
    loginAttempts++;
    
    try {
      google.script.run
        .withSuccessHandler(handleLoginResponse)
        .withFailureHandler(handleLoginError)
        .loginWithCredentials(email, password);
    } catch (error) {
      handleLoginError(error);
    }
  }
  
  function handleGoogleLogin(e) {
    e.preventDefault();
    
    if (loginAttempts >= maxAttempts) {
      showMessage('Too many login attempts. Please refresh the page and try again.', 'error');
      return;
    }
    
    setLoading(true);
    loginAttempts++;
    
    try {
      google.script.run
        .withSuccessHandler(handleLoginResponse)
        .withFailureHandler(handleLoginError)
        .loginWithGoogle();
    } catch (error) {
      handleLoginError(error);
    }
  }
  
  function handleLoginResponse(response) {
    setLoading(false);
    
    if (response && response.success) {
      showMessage('Login successful! Redirecting...', 'info');
      setTimeout(() => {
        window.location.href = response.url;
      }, 1000);
    } else {
      const message = response.message || 'Login failed. Please try again.';
      showMessage(message, 'error');
      
      // Handle account lockout
      if (response.locked) {
        disableLoginForDuration(response.unlockTime);
      }
      
      // Show remaining attempts
      if (response.attemptsRemaining !== undefined) {
        showMessage(`${message} (${response.attemptsRemaining} attempts remaining)`, 'warning');
      }
    }
  }
  
  function handleLoginError(error) {
    setLoading(false);
    console.error('Login error:', error);
    showMessage('Login system error. Please try again.', 'error');
  }
  
  function setLoading(loading) {
    if (loading) {
      loadingDiv.style.display = 'block';
      loginBtn.disabled = true;
      googleBtn.disabled = true;
      hideMessage();
    } else {
      loadingDiv.style.display = 'none';
      loginBtn.disabled = false;
      googleBtn.disabled = false;
    }
  }
  
  function showMessage(text, type = 'info') {
    messageDiv.textContent = text;
    messageDiv.className = `message ${type}`;
    messageDiv.style.display = 'block';
  }
  
  function hideMessage() {
    messageDiv.style.display = 'none';
  }
  
  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }
  
  function disableLoginForDuration(unlockTime) {
    if (!unlockTime) return;
    
    const unlockDate = new Date(unlockTime);
    const now = new Date();
    const remainingMs = unlockDate.getTime() - now.getTime();
    
    if (remainingMs > 0) {
      loginBtn.disabled = true;
      googleBtn.disabled = true;
      
      const minutes = Math.ceil(remainingMs / (1000 * 60));
      showMessage(`Account locked. Try again in ${minutes} minutes.`, 'error');
      
      setTimeout(() => {
        loginBtn.disabled = false;
        googleBtn.disabled = false;
        hideMessage();
      }, remainingMs);
    }
  }
  
  // Security: Clear sensitive data on page unload
  window.addEventListener('beforeunload', function() {
    passwordInput.value = '';
  });
</script>
</body>
</html>
